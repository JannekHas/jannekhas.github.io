<!DOCTYPE HTML>
<!--
	Stellar by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Datalogger</title>
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png">
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header" class="alt">
						<h1>Datalogger</h1>
						<p>Datenspeicherung von Jannek</p>
					</header>

				<!-- Main -->
					<div id="main">

						<section id="ubersicht" class="main special">
							<header class="major">
								<h2>Übersicht</h2>
							</header>
							<div style="display: flex; justify-content: center; gap: 0 300px; flex-wrap: wrap;">
								<div style="min-width: 150px; text-align: center;">
									<h3 id="temp-value2">-- °C</h3>
									<p id="temp-updated2">Aktualisiert: --</p>
								</div>
								<div style="min-width: 150px; text-align: center;">
									<h3 id="hum-value2">-- %</h3>
									<p id="hum-updated2">Aktualisiert: --</p>
								</div>
							</div>
						</section>

						<!-- Introduction -->
							<section id="intro" class="main special">
								<header class="major">
									<h2>Temperatur</h2>
								</header>
								<div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">
									<!-- Aktueller Wert -->
									<div style="flex: 1; min-width: 200px;">
										<h3 id="temp-value">-- °C</h3>
										<p id="temp-updated">Aktualisiert: --</p>
									</div>

									<!-- Graph -->
									<div style="flex: 2; min-width: 300px;">
										<canvas id="tempChart" width="400" height="200"></canvas>
										<div style="margin-top: 10px;">
											<button onclick="loadTempChart(120)">1h</button>
											<button onclick="loadTempChart(2880)">24h</button>
											<button onclick="loadTempChart(20160)">7d</button>
											<button onclick="loadTempChart(86400)">30d</button>
											<button onclick="loadTempChart(1051200)">1y</button>
										</div>
									</div>
								</div>
							</section>

						<!-- First Section -->
							<section id="first" class="main special">
								<header class="major">
									<h2>Relative Luftfeuchtigkeit</h2>
								</header>
								<div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">
									<!-- Aktueller Wert -->
									<div style="flex: 1; min-width: 200px;">
										<h3 id="hum-value">-- %</h3>
										<p id="hum-updated">Aktualisiert: --</p>
									</div>

									<!-- Graph -->
									<div style="flex: 2; min-width: 300px;">
										<canvas id="humChart" width="400" height="200"></canvas>
										<div style="margin-top: 10px;">
											<button onclick="loadHumChart(120)">1h</button>
											<button onclick="loadHumChart(2880)">24h</button>
											<button onclick="loadHumChart(20160)">7d</button>
											<button onclick="loadHumChart(86400)">30d</button>
											<button onclick="loadHumChart(1051200)">1y</button>
										</div>
									</div>
								</div>
							</section>

					</div>

				<!-- Footer -->
				<footer id="footer">
					<section>
						<h2>Impressum | Angaben gemäß § 5 TMG</h2>
						<p>
							Jannek Haserick<br>
							Rennweg 37<br>
							79106 Freiburg im Breisgau<br>
							Deutschland
						</p>
					</section>
					<section>
						<h3>Kontakt:</h3>
						<p>Email: <a href="mailto:JannekHas@live.de">JannekHas@live.de</a></p>
						<h3>Verantwortlich für den Inhalt:</h3>
						<p>Jannek Haserick</p>
					</section>
					<p class="copyright">© 2025 Jannek Haserick</p>
				</footer>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script>
			let tempChart;
			let humChart;

			function timeSince(dateString) {
				const now = new Date();
				const then = new Date(dateString);
				const diff = Math.floor((now - then) / 1000); // Sekunden
				if (diff < 60) return `vor ${Math.floor(diff)} Sekunden`;
				if (diff < 3600) return `vor ${Math.floor(diff / 60)} Minuten`;
				if (diff < 86400) return `vor ${Math.floor(diff / 3600)} Stunden`;
				return `am ${then.toLocaleDateString()}`;
			}

			async function loadLatestTemperature() {
				const res = await fetch("https://api.thingspeak.com/channels/2779992/fields/1.json?api_key=J4CNIE8RS3MOWWRC&results=1");
				const data = await res.json();
				if (data.feeds.length > 0) {
					const latest = data.feeds[0];
					document.getElementById("temp-value").textContent = parseFloat(latest.field1).toFixed(2) + " °C";
					document.getElementById("temp-updated").textContent = "Aktualisiert: " + timeSince(latest.created_at);
					document.getElementById("temp-value2").textContent = parseFloat(latest.field1).toFixed(2) + " °C";
					document.getElementById("temp-updated2").textContent = "Aktualisiert: " + timeSince(latest.created_at);
				}
			}

			async function loadTempChart(count) {
				const url = `https://api.thingspeak.com/channels/2779992/fields/1.json?api_key=J4CNIE8RS3MOWWRC&results=${count}`;
				const res = await fetch(url);
				const data = await res.json();
				const labels = data.feeds.map(f => new Date(f.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
				const values = data.feeds.map(f => parseFloat(f.field1));

				if (tempChart) {
					tempChart.data.labels = labels;
					tempChart.data.datasets[0].data = values;
					tempChart.update();
				} else {
					const ctx = document.getElementById("tempChart").getContext("2d");
					tempChart = new Chart(ctx, {
						type: 'line',
						data: {
							labels: labels,
							datasets: [{
								label: 'Temperatur (°C)',
								data: values,
								fill: true,
								backgroundColor: 'rgba(255, 99, 132, 0.2)',
								borderColor: 'rgba(255, 99, 132, 1)',
								tension: 0.2,
								pointRadius: 0
							}]
						},
						options: {
							scales: {
								x: {
									title: { display: true, text: 'Zeit' },
									ticks: {
										autoSkip: true,
										maxTicksLimit: 10
									}
								},
								y: {
									title: { display: true, text: '°C' }
								}
							}
						}
					});
				}
			}

			async function loadLatestHum() {
				const res = await fetch("https://api.thingspeak.com/channels/2779992/fields/2.json?api_key=J4CNIE8RS3MOWWRC&results=1");
				const data = await res.json();
				if (data.feeds.length > 0) {
					const latest = data.feeds[0];
					document.getElementById("hum-value").textContent = parseFloat(latest.field2).toFixed(2) + " %";
					document.getElementById("hum-updated").textContent = "Aktualisiert: " + timeSince(latest.created_at);
					document.getElementById("hum-value2").textContent = parseFloat(latest.field2).toFixed(2) + " %";
					document.getElementById("hum-updated2").textContent = "Aktualisiert: " + timeSince(latest.created_at);
				}
			}

			async function loadHumChart(count) {
				const url = `https://api.thingspeak.com/channels/2779992/fields/2.json?api_key=J4CNIE8RS3MOWWRC&results=${count}`;
				const res = await fetch(url);
				const data = await res.json();
				const labels = data.feeds.map(f => new Date(f.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
				const values = data.feeds.map(f => parseFloat(f.field2));

				if (humChart) {
					humChart.data.labels = labels;
					humChart.data.datasets[0].data = values;
					humChart.update();
				} else {
					const ctx = document.getElementById("humChart").getContext("2d");
					humChart = new Chart(ctx, {
						type: 'line',
						data: {
							labels: labels,
							datasets: [{
								label: 'Relative Luftfeuchtigkeit (%)',
								data: values,
								fill: true,
								backgroundColor: 'rgba(54, 162, 235, 0.2)',
								borderColor: 'rgba(54, 162, 235, 1)',
								tension: 0.2,
								pointRadius: 0
							}]
						},
						options: {
							scales: {
								x: {
									title: { display: true, text: 'Zeit' },
									ticks: {
										autoSkip: true,
										maxTicksLimit: 10
									}
								},
								y: {
									title: { display: true, text: '%' }
								}
							}
						}
					});
				}
			}

			window.addEventListener("load", () => {
				loadLatestTemperature();
				loadTempChart(120);
				loadLatestHum();
				loadHumChart(120);
			});
		</script>



	</body>
</html>